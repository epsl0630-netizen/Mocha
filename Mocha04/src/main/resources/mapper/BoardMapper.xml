<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">

	<!-- 목록 조회 -->
	<select id="selectBoardList"
		resultType="mocha.ezen.com.board.BoardDTO">
		select
		board_no, board_title, board_note, board_kind, created_at,
		updated_at,deleted_at, user_id, alarm_no
		FROM board
		<where>
			<if
				test="type != null and type == 'title' and keyword != null and keyword != ''">
				AND board_title LIKE CONCAT('%', #{keyword}, '%')
			</if>
			<if
				test="type != null and type == 'writer' and keyword != null and keyword != ''">
				AND user_id = #{keyword}
			</if>
			<if
				test="type != null and type == 'kind' and keyword != null and keyword != ''">
				AND board_kind = #{keyword}
			</if>
			AND (deleted_at IS NULL OR deleted_at = '')
		</where>
		ORDER BY board_no DESC
		LIMIT #{limit} OFFSET #{offset}
	</select>
	<!-- 전체 카운트 -->
	<select id="countBoardList" resultType="long">
		SELECT COUNT(*)
		FROM board
		<where>
			<if
				test="type != null and type == 'title' and keyword != null and keyword != ''">
				AND board_title LIKE CONCAT('%', #{keyword}, '%')
			</if>
			<if
				test="type != null and type == 'writer' and keyword != null and keyword != ''">
				AND user_id = #{keyword}
			</if>
			<if
				test="type != null and type == 'kind' and keyword != null and keyword != ''">
				AND board_kind = #{keyword}
			</if>
			AND (deleted_at IS NULL OR deleted_at = '')
		</where>
	</select>
	<!-- 단건 조회 -->
	<select id="selectBoardById" parameterType="long"
		resultType="mocha.ezen.com.board.BoardDTO">
		select
		board_no, board_title, board_note, board_kind,
		created_at,
		updated_at, deleted_at, user_id, alarm_no
		FROM board
		WHERE
		board_no = #{no}
	</select>
	<!-- 등록 -->
	<insert id="insertBoard"
		parameterType="mocha.ezen.com.board.BoardDTO" useGeneratedKeys="true"
		keyProperty="board_no">
		INSERT INTO board
		(board_title, board_note, board_kind,
		user_id, created_at)
		VALUES
		(#{board_title}, #{board_note},
		#{board_kind}, #{user_id}, NOW())
	</insert>
	<!-- 수정 -->
	<update id="updateBoard"
		parameterType="mocha.ezen.com.board.BoardDTO">
		UPDATE board
		SET board_title = #{board_title},
		board_note
		= #{board_note},
		board_kind = #{board_kind},
		updated_at = NOW()
		WHERE
		board_no = #{board_no}
	</update>
	<!-- (소프트) 삭제 -->
	<update id="deleteBoard" parameterType="long">
		UPDATE board SET
		deleted_at = NOW() WHERE board_no = #{value}
	</update>

</mapper>
